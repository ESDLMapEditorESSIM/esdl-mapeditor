L.LineUtil.PolylineDecorator={computeAngle:function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI+90},getPointPathPixelLength:function(t){var e=t.length;if(2>e)return 0;for(var n,i=0,o=t[0],s=1;e>s;s++)i+=o.distanceTo(n=t[s]),o=n;return i},getPixelLength:function(t,e){var n=t instanceof L.Polyline?t.getLatLngs():t,i=n.length;if(2>i)return 0;for(var o,s=0,r=e.project(n[0]),a=1;i>a;a++)s+=r.distanceTo(o=e.project(n[a])),r=o;return s},projectPatternOnPath:function(t,e,n,i,o){var s,r=[];for(s=0,l=t.length;s<l;s++)r[s]=o.project(t[s]);var a=this.projectPatternOnPointPath(r,e,n,i);for(s=0,l=a.length;s<l;s++)a[s].latLng=o.unproject(a[s].pt);return a},projectPatternOnPointPath:function(t,e,n,i){var o=[],s=this.getPointPathPixelLength(t)*i,r=this.interpolateOnPointPath(t,e),a=n>0?this.getPointPathPixelLength(t)*n:0;if(o.push(r),i>0){var l=t;l=l.slice(r.predecessor),l[0]=r.pt;for(var h=this.getPointPathPixelLength(l);h-a>=s;)r=this.interpolateOnPointPath(l,s/h),o.push(r),l=l.slice(r.predecessor),l[0]=r.pt,h=this.getPointPathPixelLength(l)}return o},interpolateOnPointPath:function(t,e){var n=t.length;if(2>n)return null;if(0>=e)return{pt:t[0],predecessor:0,heading:this.computeAngle(t[0],t[1])};if(e>=1)return{pt:t[n-1],predecessor:n-1,heading:this.computeAngle(t[n-2],t[n-1])};if(2==n)return{pt:this.interpolateBetweenPoints(t[0],t[1],e),predecessor:0,heading:this.computeAngle(t[0],t[1])};for(var i=this.getPointPathPixelLength(t),o=t[0],s=o,r=0,a=0,l=0,h=1;n>h&&e>a;h++)o=s,r=a,s=t[h],l+=o.distanceTo(s),a=l/i;var p=(e-r)/(a-r);return{pt:this.interpolateBetweenPoints(o,s,p),predecessor:h-2,heading:this.computeAngle(o,s)}},interpolateBetweenPoints:function(t,e,n){return e.x!=t.x?new L.Point(t.x*(1-n)+n*e.x,t.y*(1-n)+n*e.y):new L.Point(t.x,t.y+(e.y-t.y)*n)}},L.PolylineDecorator=L.FeatureGroup.extend({options:{patterns:[]},initialize:function(t,e){L.FeatureGroup.prototype.initialize.call(this),L.Util.setOptions(this,e),this._map=null,this._initPaths(t),this._initPatterns()},_initPaths:function(t){this._paths=[];if(t instanceof L.Polyline)this._initPath(t.getLatLngs(),t instanceof L.Polygon);else if(L.Util.isArray(t)&&t.length>0)if(t[0]instanceof L.Polyline)for(var e=0;e<t.length;e++)this._initPath(t[e].getLatLngs(),t[e]instanceof L.Polygon);else this._initPath(t)},_isCoordArray:function(t){return L.Util.isArray(t)&&t.length>0&&(t[0]instanceof L.LatLng||L.Util.isArray(t[0])&&2==t[0].length&&"number"==typeof t[0][0])},_initPath:function(t,e){var n;n=this._isCoordArray(t)?[t]:t;for(var i=0;i<n.length;i++)e&&n[i].push(n[i][0]),this._paths.push(n[i])},_initPatterns:function(){this._isZoomDependant=!1,this._patterns=[];for(var t,e=0;e<this.options.patterns.length;e++)t=this._parsePatternDef(this.options.patterns[e]),this._patterns.push(t),this._isZoomDependant=this._isZoomDependant||t.isOffsetInPixels||t.isEndOffsetInPixels||t.isRepeatInPixels||t.symbolFactory.isZoomDependant},setPatterns:function(t){this.options.patterns=t,this._initPatterns(),this._softRedraw()},setPaths:function(t){this._initPaths(t),this.redraw()},_parsePatternDef:function(t,e){var n={cache:[],symbolFactory:t.symbol,isOffsetInPixels:!1,isEndOffsetInPixels:!1,isRepeatInPixels:!1};return"string"==typeof t.offset&&-1!=t.offset.indexOf("%")?n.offset=parseFloat(t.offset)/100:(n.offset=t.offset?parseFloat(t.offset):0,n.isOffsetInPixels=n.offset>0),"string"==typeof t.endOffset&&-1!=t.endOffset.indexOf("%")?n.endOffset=parseFloat(t.endOffset)/100:(n.endOffset=t.endOffset?parseFloat(t.endOffset):0,n.isEndOffsetInPixels=n.endOffset>0),"string"==typeof t.repeat&&-1!=t.repeat.indexOf("%")?n.repeat=parseFloat(t.repeat)/100:(n.repeat=parseFloat(t.repeat),n.isRepeatInPixels=n.repeat>0),n},onAdd:function(t){this._map=t,this._draw(),this._isZoomDependant&&this._map.on("zoomend",this._softRedraw,this)},onRemove:function(t){this._map.off("zoomend",this._softRedraw,this),this._map=null,L.LayerGroup.prototype.onRemove.call(this,t)},_buildSymbols:function(t,e,n){for(var i=[],o=0,s=n.length;s>o;o++)i.push(e.buildSymbol(n[o],t,this._map,o,s));return i},_getCache:function(t,e,n){var i=t.cache[e];return"undefined"==typeof i?(t.cache[e]=[],null):i[n]},_getDirectionPoints:function(t,e){var n=this._map.getZoom(),i=this._getCache(e,n,t);if(i)return i;var o,s,r,a=null,l=this._paths[t];return e.isOffsetInPixels?(a=L.LineUtil.PolylineDecorator.getPixelLength(l,this._map),o=e.offset/a):o=e.offset,e.isEndOffsetInPixels?(a=null!==a?a:L.LineUtil.PolylineDecorator.getPixelLength(l,this._map),s=e.endOffset/a):s=e.endOffset,e.isRepeatInPixels?(a=null!==a?a:L.LineUtil.PolylineDecorator.getPixelLength(l,this._map),r=e.repeat/a):r=e.repeat,i=L.LineUtil.PolylineDecorator.projectPatternOnPath(l,o,s,r,this._map),e.cache[n][t]=i,i},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(t){if(null!==this._map){if(this.clearLayers(),t)for(var e=0;e<this._patterns.length;e++)this._patterns[e].cache=[];this._draw()}},_drawPattern:function(t){for(var e,n,i=0;i<this._paths.length;i++){e=this._getDirectionPoints(i,t),n=this._buildSymbols(this._paths[i],t.symbolFactory,e);for(var o=0;o<n.length;o++)this.addLayer(n[o])}},_draw:function(){for(var t=0;t<this._patterns.length;t++)this._drawPattern(this._patterns[t])}}),L.polylineDecorator=function(t,e){return new L.PolylineDecorator(t,e)},L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{TRANSFORM_ORIGIN:L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"])},_initIcon:function(){L.Marker.prototype._initIcon.call(this),this._icon.style[L.RotatedMarker.TRANSFORM_ORIGIN]=this._getTransformOrigin()},_getTransformOrigin:function(){var t=this.options.icon.options.iconAnchor;return t?t[0]+"px "+t[1]+"px":"50% 50%"},_setPos:function(t){if(L.Marker.prototype._setPos.call(this,t),L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var e=this.options.angle*(Math.PI/180),n=Math.cos(e),i=Math.sin(e);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+n+", M12="+-i+", M21="+i+", M22="+n+")"}},setAngle:function(t){this.options.angle=t}}),L.rotatedMarker=function(t,e){return new L.RotatedMarker(t,e)},L.Symbol=L.Symbol||{},L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,e,n,i,o){var s=this.options,r=Math.PI/180;if(s.pixelSize<=1)return new L.Polyline([t.latLng,t.latLng],s.pathOptions);var a=n.project(t.latLng),l=-(t.heading-90)*r,h=new L.Point(a.x+s.pixelSize*Math.cos(l+Math.PI)/2,a.y+s.pixelSize*Math.sin(l)/2),p=a.add(a.subtract(h));return new L.Polyline([n.unproject(h),n.unproject(p)],s.pathOptions)}}),L.Symbol.dash=function(t){return new L.Symbol.Dash(t)},L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){L.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,e,n,i,o){var s,r=this.options;return s=r.polygon?new L.Polygon(this._buildArrowPath(t,n),r.pathOptions):new L.Polyline(this._buildArrowPath(t,n),r.pathOptions)},_buildArrowPath:function(t,e){var n=Math.PI/180,i=e.project(t.latLng),o=-(t.heading-90)*n,s=this.options.headAngle/2*n,r=o+s,a=o-s,l=new L.Point(i.x-this.options.pixelSize*Math.cos(r),i.y+this.options.pixelSize*Math.sin(r)),h=new L.Point(i.x-this.options.pixelSize*Math.cos(a),i.y+this.options.pixelSize*Math.sin(a));return[e.unproject(l),t.latLng,e.unproject(h)]}}),L.Symbol.arrowHead=function(t){return new L.Symbol.ArrowHead(t)},L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{},rotate:!1},initialize:function(t){L.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1,this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(t,e,n,i,o){return this.options.rotate?(this.options.markerOptions.angle=t.heading+(this.options.angleCorrection||0),new L.RotatedMarker(t.latLng,this.options.markerOptions)):new L.Marker(t.latLng,this.options.markerOptions)}}),L.Symbol.marker=function(t){return new L.Symbol.Marker(t)};
//# sourceMappingURL=leaflet.polylineDecorator.min.js.map